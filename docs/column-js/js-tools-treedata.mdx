---
title: JS å·¥å…·å‡½æ•° - TreeData ç¯‡
id: js-tools-treedata
sidebar_position: 4
toc_max_heading_level: 4
---

```mdx-code-block
import { Image } from '@arco-design/web-react';
```

> æœ¬ç« èŠ‚è®°å½• JavaScript å¯¹ **æ ‘ç»“æ„** è¿›è¡Œå¤„ç†çš„ä¸€äº›å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬æ ‘ç»“æ„çš„è½¬æ¢ï¼ŒæŸ¥æ‰¾ç­‰æ–¹æ³•

## æ ‘ç»“æ„çš„è½¬æ¢

### æ•°ç»„ â†’ æ ‘ç»“æ„

æœ‰æ—¶å€™ä¼šé‡åˆ°å«æœ‰å±‚çº§ç»“æ„çš„æ•°ç»„ï¼Œè¿™æ—¶éœ€è¦é€šè¿‡æ·±åº¦ä¼˜å…ˆéå†çš„æ–¹å¼å°†å…¶è½¬æ¢ä¸ºæ ‘ç»“æ„ï¼ˆéœ€è¦æ¯ä¸€æ¡æ•°æ®å«æœ‰è‡ªèº«åŠçˆ¶çº§çš„å”¯ä¸€å€¼ï¼Œå¦‚ `id` å’Œ `parentId`ï¼‰:

```ts title="æ•°æ®ç›¸å…³çš„ç±»å‹(è‡ªå®šä¹‰)"
interface TreeDataTypes {
  pid?: number; // çˆ¶èŠ‚ç‚¹ id
  area_code: number; // è‡ªèº« id
  children?: TreeDataTypes[]; // å­èŠ‚ç‚¹ list
  [key: string]: any;
}
```

```jsx title="ä»£ç å®ç° - å£¹"
export const _dataToTree = (arr: TreeDataTypes[]) => {
  // å…ˆå°†æ•°ç»„è½¬æ¢æˆä»¥ area_code ä¸º key å€¼çš„å¯¹è±¡æ ¼å¼
  const node = arr.reduce((prev, cur) => {
    prev[cur['area_code']] = cur;
    return prev;
  }, {});

  return arr.reduce((prev, cur) => {
    const parentId = cur?.pid;
    // å¯¹è±¡çš„æµ…æ‹·è´ï¼Œå¼•ç”¨å…³ç³»å­˜åœ¨ï¼Œåœ¨åé¢å¤„ç† parent çš„æ—¶å€™ä¹Ÿä¼šå¯¼è‡´ cur çš„æ”¹å˜ï¼Œè¾¾åˆ°é€’å½’çš„æ•ˆæœ
    const parentObj = node?.[parentId];
    // å¦‚æœçˆ¶å¯¹è±¡å­˜åœ¨ï¼Œå°±å°† cur æ”¾åˆ°çˆ¶å¯¹è±¡çš„ children ä¸­
    if (parentObj) {
      parentObj.children ? parentObj.children.push(cur) : (parentObj.children = [cur]);
    }
    // æ²¡æœ‰çˆ¶å¯¹è±¡ï¼Œåˆ™æ­¤ cur ä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹
    !parentId && prev.push(cur);
    return prev;
  }, []);
};
```

```jsx title="ä»£ç å®ç° - è´° ğŸ¸"
export const _dataToTree = (arr: TreeDataTypes[]) => {
  // ä¸ ä»£ç å®ç°-å£¹ ç›¸ä¼¼ï¼Œé€šè¿‡è½¬æ¢æˆå¯¹è±¡å–å€¼æ˜ å°„çš„å½¢å¼ï¼Œä»è€Œé™ä½æ—¶é—´å¤æ‚åº¦
  const node = arr.reduce((prev, cur) => {
    prev[cur['area_code']] = cur;
    cur.children = [];
    return prev;
  }, {});

  return arr.filter((item) => {
    node[item?.pid] && node[item?.pid].children.push(item);
    return !item?.pid;
  });
};
```

```jsx title="ä»£ç å®ç° - å ğŸ¸"
export const _dataToTree = (arr: TreeDataTypes[], id = 0) => {
  // é’ˆå¯¹ä¸€çº§æ•°ç»„æ²¡æœ‰ pid çš„æƒ…å†µï¼Œå°†å…¶ pid è®¾ç½®ä¸º 0
  if (!id) {
    arr.forEach((item) => {
      if (!item?.pid) item.pid = 0;
    });
  }

  return arr
    .filter((item) => item?.pid === id)
    .map((item) => ({ ...item, children: _dataToTree(arr, item.area_code) }));
};
```

ç¤ºä¾‹:

```jsx live
function ExampleComponent(props) {
  const array = [
    { area_name: 'æµ™æ±Ÿçœ', area_code: 330000, levle: 0 },
    { area_name: 'æ­å·å¸‚', area_code: 330100, levle: 1, pid: 330000 },
    { area_name: 'ä½™æ­åŒº', area_code: 330110, levle: 2, pid: 330100 },
    { area_name: 'å†…è’™å¤è‡ªæ²»åŒº', area_code: 150000, levle: 0 },
    { area_name: 'å‘¼å’Œæµ©ç‰¹å¸‚', area_code: 150100, levle: 1, pid: 150000 },
    { area_name: 'åŒ…å¤´å¸‚', area_code: 150200, levle: 1, pid: 150000 },
    { area_name: 'é’å±±åŒº', area_code: 150204, levle: 2, pid: 150200 },
    { area_name: 'åœŸé»˜ç‰¹å³æ——', area_code: 150221, levle: 2, pid: 150200 },
  ];

  const [value, setValue] = useState({});

  return <ResultButton results={value} onClick={() => setValue(_dataToTree(array))} />;
}
```

### æ ‘ç»“æ„ â†’ æ•°ç»„

å°†æ ‘ç»“æ„æ•°æ®è¿›è¡Œå¹³é“ºå±•ç¤ºï¼Œè½¬æ¢ä¸ºä¸€ä¸ªæ™®é€šæ•°ç»„ï¼Œå¹¶ä¸”åŒ…å«å±‚çº§ä¿¡æ¯

```jsx title="ä»£ç å®ç°"
export const _treeToData = (tree: any[], result: any[] = [], level = 0) => {
  tree.forEach((item) => {
    result.push(item);
    item.level = level + 1;
    item.children && _treeToData(item.children, result, level + 1);
  });
  return result;
};
```

ç¤ºä¾‹:

```jsx live
function ExampleComponent(props) {
  const array = [
    {
      name: 'å‰ç«¯çŸ¥è¯†',
      key: '1',
      children: [
        {
          name: 'React',
          key: '1-1',
          children: [
            { name: 'Umi æ¡†æ¶', key: '1-1-1' },
            { name: 'Ant Design ç»„ä»¶', key: '1-1-2' },
          ],
        },
        { name: 'Vue', key: '1-2' },
      ],
    },
    { name: 'æœåŠ¡ç«¯çŸ¥è¯†', key: '2', children: [{ name: 'Nginx', key: '2-1' }] },
  ];

  const [value, setValue] = useState({});

  return (
    <ResultButton
      results={value}
      onClick={() => setValue(_treeToData(array))}
      jsonViewProps={{ collapsed: 1 }}
    />
  );
}
```

## æ›´æ”¹æ ‘ç»“æ„çš„ key å€¼

æœ‰æ—¶åœ¨ä½¿ç”¨ UI æ¡†æ¶ä¸­çš„ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šç¢°åˆ°ç»„ä»¶è¦çš„æ•°æ®æ ¼å¼å’Œæ‹¿åˆ°çš„æ•°æ®æ ¼å¼ä¸ä¸€è‡´ï¼Œè¿™æ—¶å°±éœ€è¦å°†æ‹¿åˆ°çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œæ›´æ”¹æˆ–æ·»åŠ ç»„ä»¶æ‰€éœ€çš„æ ¼å¼;

```ts title="æ•°æ®ç›¸å…³çš„ç±»å‹(è‡ªå®šä¹‰)"
interface TreeDataTypes {
  code: number;
  name: string;
  childList?: TreeDataTypes[];
  [key: string]: any;
}
```

```js title="ä»£ç å®ç° - å£¹"
// é€’å½’æ·»åŠ å±æ€§ ğŸ¸
export const _updateTreeKey = (tree: TreeDataTypes[]) => {
  return tree.map((item) => {
    const isHasChild = Array.isArray(item?.childList);
    return {
      ...item,
      key: item.code,
      label: item.name,
      ...(isHasChild && { children: _updateTreeKey(item?.childList) }),
    };
  });
};

// é€’å½’æ›¿æ¢å±æ€§
export const _updateTreeKey = (tree: TreeDataTypes[]) => {
  return tree.map((item) => {
    const isHasChild = Array.isArray(item?.childList);
    const newItem = {
      ...item,
      key: item.code,
      label: item.name,
      ...(isHasChild && { children: _updateTreeKey(item?.childList) }),
    };
    delete newItem.name;
    delete newItem.code;
    delete newItem?.childList;
    return newItem;
  });
};
```

```jsx title="ä»£ç å®ç° - è´°"
// æ›¿æ¢å±æ€§ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²åå†è¿›è¡Œæ›¿æ¢ï¼Œç®€å•ç²—æš´ï¼Œä½†å¹¶ä¸é€šç”¨
export const _updateTreeKey = (tree: TreeDataTypes[]) => {
  const str = JSON.stringify(tree)
    .replace(/"code"/g, '"key"') // æ›¿æ¢çš„å†…å®¹ä¸€å®šè¦åŠ å¼•å·
    .replace(/"name"/g, '"label"')
    .replace(/"childList"/g, '"children"');

  return JSON.parse(str);
};
```

ç¤ºä¾‹:

```jsx live
function ExampleComponent(props) {
  const array = [
    {
      name: 'ç»„ä»¶',
      code: 'component',
      type: 'menu',
      childList: [
        {
          name: 'é€šç”¨ç»„ä»¶',
          code: 'common_component',
          type: 'group-menu',
          childList: [
            { name: 'æŒ‰é’® Button', code: 'button', type: 'child-menu' },
            { name: 'å›¾æ ‡ Icon', code: 'icon', type: 'child-menu' },
          ],
        },
      ],
    },
  ];

  const [value, setValue] = useState({});

  return <ResultButton results={value} onClick={() => setValue(_updateTreeKey(array))} />;
}
```

## æ ‘ç»“æ„èŠ‚ç‚¹çš„æŸ¥æ‰¾

```ts title="æ•°æ®ç›¸å…³çš„ç±»å‹(è‡ªå®šä¹‰)"
interface TreeListTypes {
  code: string;
  name: string;
  children?: TreeListTypes[];
  [key: string]: any;
}
```

### è¿‡æ»¤èŠ‚ç‚¹

æ ¹æ®ä»»æ„èŠ‚ç‚¹çš„ **å”¯ä¸€å€¼**ï¼Œé€’å½’è¿‡æ»¤æ ‘ç»“æ„ï¼Œåªä¿ç•™è¯¥èŠ‚ç‚¹åŠå…¶çˆ¶èŠ‚ç‚¹ï¼Œ**è¿‡æ»¤** æ‰æ‰€æœ‰ä¸ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„:

```jsx title="ä»£ç å®ç°"
// ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°å†…å†™å…¥åˆ¤æ–­æ¡ä»¶
export const _filterTreeNode = (tree: TreeListTypes[], func: (item: TreeListTypes) => boolean) => {
  return tree
    .map((item) => ({ ...item })) // ä½¿ç”¨ map å¤åˆ¶ä¸€ä¸‹èŠ‚ç‚¹ï¼Œé¿å…ä¿®æ”¹åˆ°åŸæ ‘
    .filter((node) => {
      node.children = node.children ? _filterTreeNode(node.children, func) : [];
      return func(node) || (node.children && node.children.length);
    });
};

/* è°ƒç”¨ */
_filterTreeNode(array, (item) => item.code === value);
```

### æŸ¥æ‰¾èŠ‚ç‚¹

æ ¹æ®ä»»æ„èŠ‚ç‚¹çš„ **å”¯ä¸€å€¼**ï¼Œé€’å½’æŸ¥æ‰¾æ ‘ç»“æ„ä¸­çš„è¯¥èŠ‚ç‚¹ï¼Œè¿”å›è¯¥èŠ‚ç‚¹çš„å®Œæ•´æ•°æ®:

```diff title="ä»£ç å®ç°"
/* ä¼ å…¥çš„ func å¯ä»¥ä¸ºä¸€ä¸ªå‡½æ•° æˆ– æŒ‡å®šçš„codeï¼Œç”¨æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦ç¬¦åˆæ¡ä»¶ï¼ˆå†™æ³•å‡ä¸€è‡´ï¼Œä»¥ä¸‹é‡‡ç”¨ä¼ å…¥ func çš„æ–¹å¼ï¼‰ */

- export const _findTreeNode = (tree: TreeListTypes[], code: string) => {
+ export const _findTreeNode = (tree: TreeListTypes[], func: (item: TreeListTypes) => boolean) => {
  for (const item of tree) {
-   if (item.code === code) return item;
+   if (func(item)) return item;
    if (item.children) {
-     const res = _findTreeNode(item.children, code);
+     const res = _findTreeNode(item.children, func);
      if (res) return res;
    }
  }
  return null;
};

/* è°ƒç”¨ */
_findTreeNode(array, (item) => item.code === value);
```

### æŸ¥æ‰¾èŠ‚ç‚¹è·¯å¾„

æ ¹æ®ä»»æ„èŠ‚ç‚¹çš„ **å”¯ä¸€å€¼**ï¼Œé€’å½’æŸ¥æ‰¾æ ‘ç»“æ„ä¸­è¯¥èŠ‚ç‚¹ä¸‹åŠå…¶çˆ¶èŠ‚ç‚¹çš„è·¯å¾„ï¼Œè¿”å›ä¸€ä¸ªç”±è¿™äº›è·¯å¾„ç»„æˆçš„æ•°ç»„:

```jsx title="ä»£ç å®ç°"
// å›æº¯æ³•: ä½¿ç”¨é€’å½’çš„å…ˆåºéå†ï¼Œç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå­˜å‚¨è·¯å¾„ä¸Šæ¯ä¸ªèŠ‚ç‚¹çš„ code
export const _findTreeNodePath = (
  tree: TreeListTypes[],
  func: (item: TreeListTypes) => boolean,
  path: string[] = []
) => {
  if (!tree) return [];
  for (const item of tree) {
    path.push(item.key);
    if (func(item)) return path;
    if (item.children) {
      const res = _findTreeNodePath(item.children, func, path);
      if (res.length) return res;
    }
    path.pop(); // é¿å…æ•°ç»„å­˜åœ¨ä¹‹å‰çš„ç¼“å­˜æ•°æ®
  }
  return [];
};

/* è°ƒç”¨ */
_findTreeNodePath(array, (item) => item.code === value);
```

### æŸ¥æ‰¾å¤šæ¡èŠ‚ç‚¹è·¯å¾„

æ ¹æ®ä»»æ„èŠ‚ç‚¹çš„ **å”¯ä¸€å€¼**ï¼Œé€’å½’æŸ¥æ‰¾æ ‘ç»“æ„ä¸­è¯¥èŠ‚ç‚¹ä¸‹åŠå…¶çˆ¶èŠ‚ç‚¹çš„è·¯å¾„ï¼Œå°†è¿™äº›è·¯å¾„æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæœ€åå†è¿”å›ä¸€ä¸ªåŒ…å«è¿™äº›å­—ç¬¦ä¸²çš„æ•°ç»„:

```jsx title="ä»£ç å®ç°"
// ä¸æŸ¥è¯¢å•æ¡è·¯å¾„çš„å†™æ³•ç›¸ä¼¼
export const _findTreeManyNodePath = (
  tree: TreeListTypes[],
  func: (item: TreeListTypes) => boolean,
  path: string[] = [],
  result: string[] = []
) => {
  for (const item of tree) {
    path.push(item.key);
    func(item) && result.push([...path].join(','));
    item.children && _findTreeManyNodePath(item.children, func, path, result);
    path.pop();
  }
  return result;
};

/* è°ƒç”¨ */
_findTreeManyNodePath(array, (item) => value.includes(item.code));
```

### è·å–ç¬¬ä¸€èŠ‚ç‚¹çš„æœ€åä¸€çº§

æœ‰æ—¶ä¼šæœ‰ä¸€ä¸ªåŠ¨æ€çš„æ ‘ç»“æ„æ•°æ®ï¼Œéœ€è¦è·å–å…¶ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çš„æœ€åä¸€çº§æ•°æ®ï¼Œè¿”å›è¯¥æ•°æ®:

```jsx title="ä»£ç å®ç°"
export const _findTreeNodeToLast = (tree: TreeListTypes[]) => {
  const group: TreeListTypes[] = [];
  const loop = (org) => {
    if (!org?.children || !org?.children?.length) {
      group.push(org);
    } else {
      loop(org.children?.[0]);
    }
  };
  loop(tree?.[0]);
  return group;
};
```

### ç»¼åˆç¤ºä¾‹ ğŸ“¦

```jsx live
function ExampleComponent(props) {
  const array = [
    {
      name: 'ğŸ“‚ /',
      code: 'root',
      key: '1',
      children: [
        {
          name: 'ğŸ“‚ src',
          code: 'src',
          key: '1-1',
          children: [
            { name: 'ğŸ“‚ components', code: 'components', key: '1-1-1' },
            { name: 'ğŸ“ƒ typings.d.ts', code: 'typings-ts', key: '1-1-2' },
          ],
        },
        { name: 'ğŸ“‚ static', code: 'static', key: '1-2' },
      ],
    },
  ];

  return <Demo.DocJSToolsByTree dataSource={array} />;
}
```

## è®¡ç®—æ ‘ç»“æ„å±‚çº§æ•°

é€’å½’æ ‘ç»“æ„æ•°æ®ï¼Œè®¡ç®—ä¸€å…±æœ‰å¤šå°‘å±‚çº§;

```jsx title="ä»£ç å®ç°"
export const _getMaxLevel = (tree: any[]) => {
  let maxLevel = 0;
  const loop = (data, level) => {
    data.forEach((item) => {
      item.level = level;
      if (level > maxLevel) maxLevel = level;
      if (item?.children && item?.children?.length) {
        loop(item.children, level + 1);
      }
    });
  };
  loop(tree, 1);
  return maxLevel;
};
```

ç¤ºä¾‹:

```jsx live
function ExampleComponent(props) {
  const array = [
    {
      name: 'DTC(ä¼ä¸šç›´æ¥é¢å‘å®¢æˆ·)èƒŒæ™¯',
      level: 1,
      children: [
        {
          name: 'è¥é”€æ–¹å¼',
          level: 2,
          children: [
            {
              name: 'å†…å®¹è¥é”€',
              level: 3,
              children: [{ name: 'å¹³å°ç§è‰, æ¨å¹¿', level: 4 }],
            },
            { name: 'ç¤¾ç¾¤è¥é”€', level: 3 },
            { name: 'äº’åŠ¨è¥é”€', level: 3 },
          ],
        },
      ],
    },
  ];

  const [value, setValue] = useState();

  return (
    <ResultButton
      results={value}
      onClick={() => setValue(_getMaxLevel(array))}
      openJsonView={false}
    />
  );
}
```

## å‚è€ƒèµ„æ–™

- ğŸ‘‰ [JS æ ‘ç»“æ„æ“ä½œï¼šæŸ¥æ‰¾ã€éå†ã€ç­›é€‰ã€æ ‘ç»“æ„å’Œåˆ—è¡¨ç»“æ„ç›¸äº’è½¬æ¢ - å¾®ä¿¡](https://mp.weixin.qq.com/s/2fYDzu1Qz6CPBBUOQlTX6A)
